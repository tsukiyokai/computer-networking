# #3 网络层

与电信网相比，互联网采用的设计思路是这样的：网络层向上只提供简单灵活的、无连接的、尽最大努力的交付的数据报服务。数据报即 IP 数据报即分组。网络层提供虚电路服务和数据报服务两种服务，鉴于 TCP/IP 体系的网络层提供的是数据报服务，因此下面仅讨论网络层如何传送 IP 数据报这个主题。

## 网际协议 IP

一般所讲的 IP 指 IPv4，但讲述 IP 协议的各种原理时往往不在 IP 后面加上版本号。

与 IP 协议配套使用的还有三个协议：

- 地址解析协议 ARP

- 网际控制报文协议 ICMP

  ping 用来测试两个主机的连通性

- 网际组管理协议 IGMP

由于网际协议 IP 是用来使互连起来的许多计算机网络能够通信的，因此 TCP/IP 体系中的网络层常常被称为网际层或 IP 层。使用网际层这个名词的好处是强调这是由许多网络构成的互联网络。

使网络互相连接起来需要中间设备，根据中间设备所在的层次，可以有以下四种不同的中间设备：

- 物理层使用的中间设备：转发器（repeater）
- 数据链路层使用的中间设备：网桥（bridge）或桥接器
- 网络层使用的中间设别：路由器（router）
- 网络层以上使用的中间设备：网关（gateway）。用网关连接两个不兼容的系统需要在高层进行协议的转换。

当中间设备是转发器或者网桥时，这仅仅是吧一个网络扩大了，而从网络层的角度看，这仍然是一个网络，一般并不称之为网络互连。网管由于较复杂目前使用较少。因此在讨论网络互连时，都是指用路由器进行网络互连和路由选择。路由器其实就是一台专用计算机，用来在互联网中进行路由选择。

互联网可以由多种异构网络互连组成。因此要真正理解，网络层的网络并非网络，而是网络的网络。

### 地址解析协议 ARP 的作用

地址解析协议解决这样的问题：已知一台机器的 IP 地址，解析出其相应的硬件地址（把 IP 地址解析为硬件地址）。它解决同一个局域网上的主机或路由器的 IP 地址和硬件地址的映射问题。ARP 的高速缓存可以大大减少网络上的通信量。在互联网中，我们无法仅根据硬件地址寻找到在某个网络上的某台主机。因此，从 IP 地址到硬件地址的解析使非常必要的。

