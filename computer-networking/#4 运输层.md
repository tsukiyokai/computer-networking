# #4 运输层 transport layer

重要概念：

1. 运输层为相互通信的应用进程提供逻辑通信。
2. 端口和套接字的意义。
3. 无连接的 UDP 的特点。
4. 面向连接的 TCP 的特点。
5. 在不可靠的网络上实现可靠传输的工作原理，停止等待协议和 ARQ 协议。
6. TCP 的滑动窗口、流量控制、拥塞控制、连接管理。

## 运输层协议概述

网络层为主机之间提供逻辑通信。但是真正进行通信的实体是主机中的进程，而运输层正是为应用进程之间提供端到端的通信。

> “逻辑通信”的意思是“好像是这样通信，但事实上并非真的这样通信”。

运输层要对收到的报文进行差错检测。而网络层只检测首部不检测数据部分。

根据应用进程的不同需求，运输层有两种不同的运输协议：面向连接的 TCP 和无连接的 UDP。

PDU：根据所使用的协议是 TCP 或 UDP，协议数据单元分别称之为 TCP 报文段 或 UDP 用户数据报。

## 用户数据报协议 UDP

UDP 的主要特点：

1. UDP 是无连接的，即发送数据之前不需要建立连接，当然发送数据结束时也没有连接可释放。因此减少了开销和发送数据之前的时延。
2. UDP 使用尽最大努力交付，即不保证可靠性交付，因此主机不需要维持复杂的链接状态表。
3. UDP 是面向报文的。对于发送方的应用层交下来的报文，UDP 只添加首部后就原封不动地交付给下面的 IP 层。对于接收时从 IP 层交上来地 UDP 用户数据报，去除首部后就原封不动地交付给上面的应用层中的应用程序。即，UDP 一次交付一个完整报文，因此应用程序必须选择合适大小的报文。
4. UDP 没有拥塞控制。因此网络中的拥塞不会使源主机地发送速率降低，很多实时应用要求源主机以恒定速率发送数据，并允许在网络发生拥塞时丢失一些数据，但不允许数据有太大延迟（比如实时视频会议）。UDP 正好适合这种。
5. UDP 支持一对一、一对多、多对一和多对多地交互通信。
6. UDP 的首部开销比 TCP 小。

UDP 的首部格式：